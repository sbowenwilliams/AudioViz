// tquery.js - https://github.com/jeromeetienne/tquery - MIT License
var tQuery=function(object,root){if(arguments.length===2&&(arguments[0]instanceof THREE.Geometry||arguments[0]instanceof THREE.BufferGeometry||arguments[0]instanceof tQuery.Geometry)&&(arguments[1]instanceof THREE.Material||arguments[1]instanceof tQuery.Material)){var tGeometry=arguments[0]instanceof tQuery.Geometry?arguments[0].get(0):arguments[0];var tMaterial=arguments[1]instanceof tQuery.Material?arguments[1].get(0):arguments[1];var tMesh=new THREE.Mesh(tGeometry,tMaterial);return tQuery(tMesh)}var instance=Array.isArray(object)?object[0]:object;if(instance instanceof THREE.Mesh&&tQuery.Mesh){return new tQuery.Mesh(object)}else if(instance instanceof THREE.DirectionalLight&&tQuery.DirectionalLight){return new tQuery.DirectionalLight(object)}else if(instance instanceof THREE.AmbientLight&&tQuery.AmbientLight){return new tQuery.AmbientLight(object)}else if(instance instanceof THREE.Light&&tQuery.Light){return new tQuery.Light(object)}else if(instance instanceof THREE.Object3D&&tQuery.Object3D){return new tQuery.Object3D(object)}else if(instance instanceof THREE.Geometry&&tQuery.Geometry){return new tQuery.Geometry(object)}else if(instance instanceof THREE.Material&&tQuery.Material){return new tQuery.Material(object)}else if(typeof instance==="string"&&tQuery.Object3D){return new tQuery.Object3D(object,root)}else{console.assert(false,"unsupported type")}return undefined};tQuery.VERSION="r59.0";tQuery.data=function(object,key,value,mustNotExist){console.assert(object,"invalid parameters");console.assert(typeof key==="string","invalid parameters");if(mustNotExist===undefined&&value!==undefined)mustNotExist=true;object["_tqData"]=object["_tqData"]||{};if(mustNotExist){console.assert(object["_tqData"][key]===undefined,"This key already exists "+key)}if(value){object["_tqData"][key]=value}return object["_tqData"][key]};tQuery.hasData=function(object,key){if(object["_tqData"]===undefined)return false;if(object["_tqData"][key]===undefined)return false;return true};tQuery.removeData=function(object,key,mustExist){if(key instanceof Array){key.forEach(function(key){tQuery.removeData(object,key)});return}console.assert(typeof key==="string");if(mustExist){console.assert(object["_tqData"][key]!==undefined,"This key doesnt already exists "+key)}delete object["_tqData"][key]};tQuery.each=function(arr,callback){for(var i=0;i<arr.length;i++){var keepLooping=callback(arr[i],i,arr);if(keepLooping===false)return false}return true};tQuery.now=function(){var p=window.performance||{};if(p.now)return function(){return p.timing.navigationStart+p.now()};else if(p.mozNow)return function(){return p.timing.navigationStart+p.mozNow()};else if(p.webkitNow)return function(){return p.timing.navigationStart+p.webkitNow()};else if(p.mskitNow)return function(){return p.timing.navigationStart+p.msNow()};else if(p.okitNow)return function(){return p.timing.navigationStart+p.oNow()};else return function(){return Date.now}}();tQuery.nowSeconds=function(){return tQuery.now()/1e3};tQuery.inherit=function(childClass,parentClass){var tempFn=function(){};tempFn.prototype=parentClass.prototype;childClass.prototype=new tempFn;childClass.parent=parentClass.prototype;childClass.prototype.constructor=childClass};tQuery.extend=function(obj,base,deep){deep=deep!==undefined?deep:true;var extendFn=deep?deepExtend:shallowExtend;var result={};base&&extendFn(result,base);obj&&extendFn(result,obj);return result;function shallowExtend(dst,src){Object.keys(src).forEach(function(key){dst[key]=src[key]})}function deepExtend(dst,src){for(var property in src){if(src[property]&&src[property].constructor&&src[property].constructor===Object){dst[property]=dst[property]||{};arguments.callee(dst[property],src[property])}else{dst[property]=src[property]}}return dst}};tQuery._pluginsOn=function(object,dest,fnNameSuffix){dest=dest||object.prototype||object;fnNameSuffix=fnNameSuffix||"";console.assert(object["register"+fnNameSuffix]===undefined);console.assert(object["unregister"+fnNameSuffix]===undefined);console.assert(object["registered"+fnNameSuffix]===undefined);object["register"+fnNameSuffix]=function(name,funct){console.assert(dest[name]===undefined,"Conflict! Already method called: "+name);dest[name]=funct};object["unregister"+fnNameSuffix]=function(name){if(dest.hasOwnProperty(name)===false){throw new Error("Plugin not found: "+name)}delete dest[name]};object["registered"+fnNameSuffix]=function(name){return dest.hasOwnProperty(name)===true}};tQuery.pluginsInstanceOn=function(klass){tQuery._pluginsOn(klass,undefined,"Instance")};tQuery.pluginsStaticOn=function(klass){tQuery._pluginsOn(klass,klass,"Static")};tQuery.pluginsStaticOn(tQuery);tQuery.mixinAttributes=function(dstObject,properties){dstObject.prototype._attrProps=tQuery.extend(dstObject.prototype._attrProps,properties);dstObject.prototype.attr=function(name,args){if(name instanceof Object&&args===undefined){Object.keys(name).forEach(function(key){this.attr(key,name[key])}.bind(this))}else if(typeof name==="string"){console.assert(Object.keys(this._attrProps).indexOf(name)!==-1,"invalid property name:"+name)}else console.assert(false,"invalid parameter");if(args!==undefined){var convertFn=this._attrProps[name];var value=convertFn.apply(convertFn,args);this.each(function(element){element[name]=value});return this}if(this.length===0)return undefined;var element=this.get(0);return element[name]};Object.keys(properties).forEach(function(name){dstObject.prototype[name]=function(){return this.attr(name,arguments)}}.bind(this))};tQuery.Flow=function(){var self,stack=[],timerId=setTimeout(function(){timerId=null;self._next()},0);return self={destroy:function(){timerId&&clearTimeout(timerId)},par:function(callback,isSeq){if(isSeq||!(stack[stack.length-1]instanceof Array))stack.push([]);stack[stack.length-1].push(callback);return self},seq:function(callback){return self.par(callback,true)},_next:function(err,result){var errors=[],results=[],callbacks=stack.shift()||[],nbReturn=callbacks.length,isSeq=nbReturn==1;callbacks&&callbacks.forEach(function(fct,index){fct(function(error,result){errors[index]=error;results[index]=result;if(--nbReturn==0)self._next(isSeq?errors[0]:errors,isSeq?results[0]:results)},err,result)})}}};tQuery.MicroeventMixin=function(destObj){var bind=function(event,fct){if(this._events===undefined)this._events={};this._events[event]=this._events[event]||[];this._events[event].push(fct);return fct};var unbind=function(event,fct){if(this._events===undefined)this._events={};if(event in this._events===false)return;this._events[event].splice(this._events[event].indexOf(fct),1)};var trigger=function(event){if(this._events===undefined)this._events={};if(this._events[event]===undefined)return;var tmpArray=this._events[event].slice();for(var i=0;i<tmpArray.length;i++){var result=tmpArray[i].apply(this,Array.prototype.slice.call(arguments,1));if(result!==undefined)return result}return undefined};destObj.bind=bind;destObj.unbind=unbind;destObj.trigger=trigger;destObj.addEventListener=function(event,fct){this.bind(event,fct);return this};destObj.removeEventListener=function(event,fct){this.unbind(event,fct);return this};destObj.dispatchEvent=function(event){return this.trigger.apply(this,arguments)};return destObj};tQuery.MicroCache=function(){var _values={};return{get:function(key){return _values[key]},contains:function(key){return key in _values},remove:function(key){delete _values[key]},set:function(key,value){_values[key]=value},values:function(){return _values},getSet:function(key,value){if(!this.contains(key)){this.set(key,typeof value=="function"?value():value)}return this.get(key)}}};tQuery.mixinCreatorPattern=function(klass,name){var jsCode=["klass.create = (function() {","	function F(args) {","		return klass.apply(this, args);","	}","	F.prototype = klass.prototype;","	return function(){","		return new F(arguments);","	}","})()"].join("\n");name=name||klass.name;jsCode=name?jsCode.replace(/F/g,name):jsCode;eval(jsCode)};tQuery.convert={};tQuery.convert.toThreeColor=function(){var result=tQuery.convert.toThreeColor.dispatchEvent("preConvert",arguments);if(result!==undefined)return result;if(arguments.length===1&&typeof arguments[0]==="number"){return new THREE.Color(arguments[0])}else if(arguments.length===1&&typeof arguments[0]==="string"){return new THREE.Color(arguments[0])}else if(arguments.length===1&&arguments[0]instanceof THREE.Color){return arguments[0]}else if(arguments.length===3&&typeof arguments[0]==="number"&&typeof arguments[1]==="number"&&typeof arguments[2]==="number"){return(new THREE.Color).setRGB(arguments[0],arguments[1],arguments[2])}else{console.assert(false,"invalid parameter")}return undefined};tQuery.MicroeventMixin(tQuery.convert.toThreeColor);tQuery.convert.toThreeMaterial=function(){var result=tQuery.convert.toThreeMaterial.dispatchEvent("preConvert",arguments);if(result!==undefined)return result;if(arguments.length===1&&arguments[0]instanceof THREE.Material){return arguments[0]}else if(arguments.length===1&&arguments[0]instanceof tQuery.Material){return arguments[0].get(0)}else{console.assert(false,"invalid parameter")}return undefined};tQuery.MicroeventMixin(tQuery.convert.toThreeMaterial);tQuery.convert.toVector3=function(){if(arguments.length===0){return new THREE.Vector3}else if(arguments[0]instanceof THREE.Vector3&&arguments.length===1){return arguments[0]}else if(typeof arguments[0]==="number"&&arguments.length===3){return new THREE.Vector3(arguments[0],arguments[1],arguments[2])}else if(arguments[0]instanceof Array&&arguments.length===1){return new THREE.Vector3(arguments[0][0],arguments[0][1],arguments[0][2])}else{console.assert(false,"invalid parameter for Vector3")}};tQuery.convert.toVector2=function(){if(arguments[0]instanceof THREE.Vector2&&arguments.length===1){return arguments[0]}else if(typeof arguments[0]==="number"&&arguments.length===2){return new THREE.Vector2(arguments[0],arguments[1])}else{console.assert(false,"invalid parameter for Vector2")}};tQuery.convert.toNumber=function(value){if(arguments.length===1&&typeof value==="number"){return value}else{console.assert(false,"invalid parameter")}return undefined};tQuery.convert.toNumberZeroToOne=function(value){if(arguments.length===1&&typeof value==="number"){value=Math.min(value,1);value=Math.max(value,0);return value}else{console.assert(false,"invalid parameter")}return undefined};tQuery.convert.toInteger=function(value){if(arguments.length===1&&typeof value==="number"){value=Math.floor(value);return value}else{console.assert(false,"invalid parameter")}return undefined};tQuery.convert.identity=function(value){return value};tQuery.convert.toBoolean=function(value){if(arguments.length===1&&typeof value==="boolean"){return value}else{console.assert(false,"invalid parameter")}return undefined};tQuery.convert.toString=function(value){if(arguments.length===1&&typeof value==="string"){return value}else{console.assert(false,"invalid parameter")}return undefined};tQuery.convert.toTextureCube=function(){var result=this.dispatchEvent("preConvert",arguments);if(result!==undefined)return result;return tQuery.convert.toTexture.apply(tQuery.convert.toTexture,arguments)};tQuery.MicroeventMixin(tQuery.convert.toTextureCube);tQuery.convert.toTexture=function(value){var result=this.dispatchEvent("preConvert",arguments);if(result!==undefined)return result;if(arguments.length===1&&value instanceof tQuery.Texture){return arguments[0].get(0)}else if(arguments.length===1&&value instanceof THREE.Texture){return value}else if(arguments.length===1&&value instanceof THREE.WebGLRenderTarget){return value}else if(arguments.length===1&&typeof value==="string"){return THREE.ImageUtils.loadTexture(value)}else if(arguments.length===1&&(value instanceof Image||value instanceof HTMLVideoElement||value instanceof HTMLCanvasElement)){var texture=new THREE.Texture(value);texture.needsUpdate=true;return texture}else{console.assert(false,"invalid parameter")}return undefined};tQuery.MicroeventMixin(tQuery.convert.toTexture);tQuery.Node=function(object){if(object instanceof Array)this._lists=object;else if(!object)this._lists=[];else this._lists=[object];this.length=this._lists.length};tQuery.Node.prototype.get=function(idx){if(idx===undefined)return this._lists;console.assert(this._lists[idx],"element not defined");return this._lists[idx]};tQuery.Node.prototype.each=function(callback){return tQuery.each(this._lists,callback)};tQuery.Node.prototype.back=function(value){if(value===undefined)return this._back;this._back=value;return this};tQuery.Node.prototype.data=function(key,value,mustNotExist){if(value!==undefined){this.each(function(element){tQuery.data(element,key,value,mustNotExist)});return this}if(this.length>0)return tQuery.data(this.get(0),key);console.assert(this.length===0);return undefined};tQuery.Node.prototype.removeData=function(key){this.each(function(element){tQuery.removeData(element,key)});return this};tQuery.Object3D=function(object,root){if(typeof object==="string"){object=tQuery.Object3D._select(object,root)}tQuery.Object3D.parent.constructor.call(this,object);this._lists.forEach(function(item){console.assert(item instanceof THREE.Object3D)})};tQuery.inherit(tQuery.Object3D,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Object3D);tQuery.pluginsStaticOn(tQuery.Object3D);tQuery.mixinAttributes(tQuery.Object3D,{eulerOrder:tQuery.convert.toString,doubleSided:tQuery.convert.toBoolean,flipSided:tQuery.convert.toBoolean,rotationAutoUpdate:tQuery.convert.toBoolean,matrixAutoUpdate:tQuery.convert.toBoolean,matrixWorldNeedsUpdate:tQuery.convert.toBoolean,useQuaternion:tQuery.convert.toBoolean,visible:tQuery.convert.toBoolean,receiveShadow:tQuery.convert.toBoolean,castShadow:tQuery.convert.toBoolean});tQuery.Object3D.prototype.traverse=function(callback){this.each(function(tObject3d){tObject3d.traverse(function(childObject3D){callback(childObject3D,this)})});return this};tQuery.Object3D.prototype.geometry=function(value){var geometries=[];this.each(function(object3d){geometries.push(object3d.geometry)});return new tQuery.Geometry(geometries).back(this)};tQuery.Object3D.prototype.material=function(){var tMaterials=[];this.each(function(object3d){tMaterials.push(object3d.material)});return new tQuery.Material(tMaterials)};tQuery.Object3D.prototype.clone=function(){var clones=[];this.each(function(tObject3d){var clone=tObject3d.clone();clones.push(clone)});return tQuery(clones)};tQuery.Object3D.prototype.lookAt=function(position){position=tQuery.convert.toVector3.apply(null,arguments);this.each(function(tObject3d){tObject3d.lookAt(position)});return this};tQuery.Object3D.prototype.addTo=function(target){console.assert(target instanceof tQuery.World||target instanceof tQuery.Object3D||target instanceof THREE.Object3D);this.each(function(object3d){target.add(object3d)}.bind(this));return this};tQuery.Object3D.prototype.removeFrom=function(target){console.assert(target instanceof tQuery.World||target instanceof tQuery.Object3D);this.each(function(tObject3d){target.remove(tObject3d)}.bind(this));return this};tQuery.Object3D.prototype.detach=function(){this.each(function(object3D){if(!object3D.parent)return;object3D.parent.remove(object3D)}.bind(this));return this};tQuery.Object3D.prototype.add=function(object3D){if(object3D instanceof tQuery.Object3D){this.each(function(object1){object3D.each(function(object2){object1.add(object2)})}.bind(this))}else if(object3D instanceof THREE.Object3D){if(this.length>0){this.each(function(tObject3D){tObject3D.add(object3D)})}else{this._lists.push(object3D)}}else console.assert(false,"invalid parameter");return this};tQuery.Object3D.prototype.remove=function(object3D){if(object3D instanceof tQuery.Object3D){this.each(function(object1){object3D.each(function(object2){object1.remove(object2)})}.bind(this))}else if(object3D instanceof THREE.Object3D){this.each(function(object1){object1.remove(object3D)})}else console.assert(false,"invalid parameter");return this};tQuery.Object3D.prototype.name=function(value){console.assert(this.length<=1,"tQuery.Object3D.id used on multi-elements");if(value===undefined){if(this.length===0)return undefined;var tObject3d=this.get(0);return tObject3d.name}if(this.length===0)return undefined;var tObject3d=this.get(0);tObject3d.name=value;return this};tQuery.Object3D.prototype.id=function(value){console.assert(this.length<=1,"tQuery.Object3D.id used on multi-elements");if(value!==undefined){if(this.length>0){var object3d=this.get(0);object3d._tqId=value}return this}else{if(this.length>0){var object3d=this.get(0);return object3d._tqId}return undefined}};tQuery.Object3D.prototype.addClass=function(className){this.each(function(tObject3d){tObject3d._tqClasses=tObject3d._tqClasses||"";if(tQuery.Object3D._hasClassOne(tObject3d,className))return;tObject3d._tqClasses+=" "+className}.bind(this));return this};tQuery.Object3D.prototype.removeClass=function(className){this.each(function(tObject3d){tQuery.Object3D._removeClassOne(tObject3d,className)}.bind(this));return this};tQuery.Object3D.prototype.hasClass=function(className){var completed=this.each(function(object3d){object3d._tqClasses=object3d._tqClasses||"";var hasClass=tQuery.Object3D._hasClassOne(object3d,className);return hasClass?false:true}.bind(this));return completed?false:true};tQuery.Object3D._hasClassOne=function(object3d,className){if(object3d._tqClasses===undefined)return false;var classes=object3d._tqClasses;var re=new RegExp("(^| |	)+("+className+")($| |	)+");return classes.match(re)?true:false};tQuery.Object3D._removeClassOne=function(object3d,className){if(object3d._tqClasses===undefined)return;var re=new RegExp("(^| |	)("+className+")($| |	)");object3d._tqClasses=object3d._tqClasses.replace(re," ")};tQuery.Object3D._select=function(selector,root){root=root||tQuery.world.tScene();if(root instanceof tQuery.Object3D)root=root.get(0);var selectItems=selector.split(" ").filter(function(v){return v.length>0});console.assert(root instanceof THREE.Object3D);var lists=[];root.children.forEach(function(child){var nodes=this._crawls(child,selectItems);lists=lists.concat(nodes)}.bind(this));return lists};tQuery.Object3D._crawls=function(root,selectItems){var result=[];console.assert(selectItems.length>=1);var match=this._selectItemMatch(root,selectItems[0]);var nextSelect=match?selectItems.slice(1):selectItems;if(nextSelect.length===0)return[root];root.children.forEach(function(child){var nodes=this._crawls(child,nextSelect);result=result.concat(nodes)}.bind(this));return result};tQuery.Object3D._selectableGeometries=Object.keys(THREE).filter(function(value){return value.match(/.+Geometry$/)}).map(function(value){return value.replace(/Geometry$/,"").toLowerCase()});tQuery.Object3D._selectableLights=Object.keys(THREE).filter(function(value){return value.match(/.+Light$/)}).map(function(value){return value.replace(/Light$/,"").toLowerCase()});tQuery.Object3D._selectableClasses=["mesh","light"];tQuery.Object3D._selectItemMatch=function(object3d,selectItem){console.assert(object3d instanceof THREE.Object3D);console.assert(typeof selectItem==="string");var subItems=selectItem.match(new RegExp("([^.#]+|.[^.#]+|#[^.#]+)","g"));var completed=tQuery.each(subItems,function(subItem){var meta=subItem.charAt(0);var suffix=subItem.slice(1);if(meta==="."){var hasClass=tQuery.Object3D._hasClassOne(object3d,suffix);return hasClass?true:false}else if(meta==="#"){return object3d._tqId===suffix?true:false}else if(meta==="["){var matches=subItem.match(/\[(.*)([=])(.*)\]/);var key=matches[1];var operator=matches[2];var value=matches[3].replace(/^['"]/,"").replace(/['"]$/,"");if(key==="name"){if(operator==="="){return object3d.name===value?true:false}else{console.assert("operator not handled")}}else{console.assert(false,"key not handled:",key)}console.assert(false,"this point should never be reached");return undefined}else if(subItem==="*"){return true}else if(this._selectableGeometries.indexOf(subItem)!==-1){var geometry=object3d.geometry;var className=subItem.charAt(0).toUpperCase()+subItem.slice(1)+"Geometry";return geometry instanceof THREE[className]}else if(this._selectableLights.indexOf(subItem)!==-1){var className=subItem.charAt(0).toUpperCase()+subItem.slice(1)+"Light";return object3d instanceof THREE[className]}else if(this._selectableClasses.indexOf(subItem)!==-1){var className=subItem.charAt(0).toUpperCase()+subItem.slice(1);return object3d instanceof THREE[className]}console.assert(false,"invalid selector: "+subItem);return true}.bind(this));return completed?true:false};tQuery.Geometry=function(object){tQuery.Geometry.parent.constructor.call(this,object);this._lists.forEach(function(item){console.assert(item instanceof THREE.Geometry)})};tQuery.inherit(tQuery.Geometry,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Geometry);tQuery.mixinAttributes(tQuery.Geometry,{hasTangents:tQuery.convert.toBoolean,dynamic:tQuery.convert.toBoolean});tQuery.Material=function(object){tQuery.Material.parent.constructor.call(this,object);this._lists.forEach(function(item){console.assert(item instanceof THREE.Material)})};tQuery.inherit(tQuery.Material,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Material);tQuery.mixinAttributes(tQuery.Material,{opacity:tQuery.convert.toNumber,transparent:tQuery.convert.toBoolean});tQuery.Light=function(elements){tQuery.Light.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.Light)})};tQuery.inherit(tQuery.Light,tQuery.Object3D);tQuery.pluginsInstanceOn(tQuery.Light);tQuery.mixinAttributes(tQuery.Light,{color:tQuery.convert.toThreeColor});tQuery.Mesh=function(elements){var parent=tQuery.Mesh.parent;parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.Mesh)})};tQuery.inherit(tQuery.Mesh,tQuery.Object3D);tQuery.pluginsInstanceOn(tQuery.Mesh);tQuery.MicroeventMixin(tQuery.Mesh.prototype);tQuery.Mesh.prototype.material=function(value){var parent=tQuery.Mesh.parent;if(value===undefined)return parent.material.call(this);if(value instanceof tQuery.Material)value=value.get(0);console.assert(value instanceof THREE.Material||value instanceof THREE.FaceMaterial);this.each(function(tMesh){tMesh.material=value});return this};tQuery.registerStatic("createSprite",function(opts,material){if(arguments.length===1&&(opts instanceof THREE.Material||opts instanceof tQuery.Material)){material=tQuery.convert.toThreeMaterial(opts);opts=undefined}var tSprite=new THREE.Sprite(opts);var sprite=new tQuery.Sprite(tSprite);if(material)sprite.material(material);return sprite});tQuery.registerStatic("Sprite",function(elements){tQuery.Sprite.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.Sprite)})});tQuery.inherit(tQuery.Sprite,tQuery.Object3D);tQuery.pluginsInstanceOn(tQuery.Sprite);tQuery.mixinAttributes(tQuery.Sprite,{rotation:tQuery.convert.toNumber});tQuery.Sprite.prototype.material=function(value){var parent=tQuery.Sprite.parent;if(value===undefined)return parent.material.call(this);if(value instanceof tQuery.Material)value=value.get(0);console.assert(value instanceof THREE.SpriteMaterial);this.each(function(tSprite){tSprite.material=value});return this};tQuery.World=function(opts){opts=opts||{};opts=tQuery.extend(opts,{renderW:window.innerWidth,renderH:window.innerHeight,webGLNeeded:true,autoRendering:true,scene:null,camera:null,renderer:null});this._opts=opts;console.assert(!tQuery.word);tQuery.world=this;this._autoRendering=opts.autoRendering;this._tScene=opts.scene||new THREE.Scene;if(!opts.camera){this._tCamera=new THREE.PerspectiveCamera(45,opts.renderW/opts.renderH,.01,1e4);this._tCamera.position.set(0,0,3);this._tScene.add(this._tCamera)}else{this._tCamera=opts.camera}this._loop=new tQuery.Loop;this._$loopCb=this._loop.hookOnRender(function(delta,now){this.render(delta)}.bind(this));if(opts.renderer){this._tRenderer=opts.renderer}else if(tQuery.World.hasWebGL()){this._tRenderer=new THREE.WebGLRenderer({antialias:true,preserveDrawingBuffer:true});this._tRenderer.setClearColor(12303291,1);this._tRenderer.setSize(opts.renderW,opts.renderH)}else if(!opts.webGLNeeded){this._tRenderer=new THREE.CanvasRenderer;this._tRenderer.setClearColor(12303291,1);this._tRenderer.setSize(opts.renderW,opts.renderH)}else{this._addGetWebGLMessage();throw new Error("WebGL required and not available")}};tQuery.pluginsInstanceOn(tQuery.World);tQuery.MicroeventMixin(tQuery.World.prototype);tQuery.World.prototype.destroy=function(){this.trigger("destroy");this._loop.unhookOnRender(this._$loopCb);this._loop.destroy();this.removeCameraControls();var parent=this._tRenderer.domElement.parentElement;parent&&parent.removeChild(this._tRenderer.domElement);if(tQuery.world===this)tQuery.world=null};tQuery.World._hasWebGL=undefined;tQuery.World.hasWebGL=function(){if(tQuery.World._hasWebGL!==undefined)return tQuery.World._hasWebGL;try{tQuery.World._hasWebGL=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){tQuery.World._hasWebGL=false}return tQuery.World._hasWebGL};tQuery.World.prototype._addGetWebGLMessage=function(parent){parent=parent||document.body;var domElement=document.createElement("div");domElement.style.fontFamily="monospace";domElement.style.fontSize="13px";domElement.style.textAlign="center";domElement.style.background="#eee";domElement.style.color="#000";domElement.style.padding="1em";domElement.style.width="475px";domElement.style.margin="5em auto 0";domElement.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n");parent.appendChild(domElement)};tQuery.World.prototype.setCameraControls=function(control){if(this.hasCameraControls())this.removeCameraControls();this._tCameraControls=control;return this};tQuery.World.prototype.getCameraControls=function(){return this._tCameraControls};tQuery.World.prototype.removeCameraControls=function(){if(this.hasCameraControls()===false)return this;this._tCameraControls=undefined;return this};tQuery.World.prototype.hasCameraControls=function(){return this._tCameraControls!==undefined?true:false};tQuery.World.prototype.add=function(object3d){if(object3d instanceof tQuery.Object3D){object3d.each(function(object3d){this._tScene.add(object3d)}.bind(this))}else if(object3d instanceof THREE.Object3D){this._tScene.add(object3d)}else console.assert(false,"invalid type");return this};tQuery.World.prototype.remove=function(object3d){if(object3d instanceof tQuery.Object3D){object3d.each(function(object3d){this._tScene.remove(object3d)}.bind(this))}else if(object3d instanceof THREE.Object3D){this._tScene.remove(object3d)}else console.assert(false,"invalid type");return this};tQuery.World.prototype.appendTo=function(domElement){domElement.appendChild(this._tRenderer.domElement);return this};tQuery.World.prototype.start=function(){this._loop.start();return this};tQuery.World.prototype.stop=function(){this._loop.stop();return this};tQuery.World.prototype.hook=function(priority,callback){return this._loop.hook(priority,callback)};tQuery.World.prototype.unhook=function(priority,callback){return this._loop.unhook(priority,callback)};tQuery.World.prototype.loop=function(){return this._loop};tQuery.World.prototype.tRenderer=function(){return this._tRenderer};tQuery.World.prototype.tScene=function(){return this._tScene};tQuery.World.prototype.tCamera=function(){return this._tCamera};tQuery.World.prototype.scene=function(){return tQuery(this._tScene)};tQuery.World.prototype.camera=function(){return tQuery(this._tCamera)};tQuery.World.prototype.autoRendering=function(value){if(value===undefined)return this._autoRendering;this._autoRendering=value;return this};tQuery.World.prototype.render=function(delta){if(this.hasCameraControls())this._tCameraControls.update(delta);if(this._autoRendering)this._tRenderer.render(this._tScene,this._tCamera)};tQuery.Loop=function(){this._hooks=[];this._lastTime=null};tQuery.pluginsInstanceOn(tQuery.Loop);tQuery.Loop.prototype.destroy=function(){this.stop()};tQuery.Loop.prototype.start=function(){if(this._timerId)this.stop();this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));return this};tQuery.Loop.prototype.stop=function(){cancelAnimationFrame(this._timerId);this._timerId=null;return this};tQuery.Loop.prototype.isRunning=function(){return this._timerId?true:false};tQuery.Loop.prototype.pauseToggle=function(){if(this.isRunning())this.stop();else this.start();return this};tQuery.Loop.maxDelta=1/5;tQuery.Loop.prototype._onAnimationFrame=function(){this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));this.tick()};tQuery.Loop.prototype.tick=function(){var now=tQuery.nowSeconds();if(!this._lastTime)this._lastTime=now-1/60;var minLastTime=now-tQuery.Loop.maxDelta;if(this._lastTime<minLastTime){this._lastTime=minLastTime}var delta=now-this._lastTime;this._lastTime=now;for(var priority=0;priority<=this._hooks.length;priority++){if(this._hooks[priority]===undefined)continue;var callbacks=this._hooks[priority].slice(0);for(var i=0;i<callbacks.length;i++){callbacks[i](delta,now)}}};tQuery.Loop.prototype.PRE_RENDER=20;tQuery.Loop.prototype.ON_RENDER=50;tQuery.Loop.prototype.POST_RENDER=80;tQuery.Loop.prototype.hook=function(priority,callback){if(typeof priority==="function"){callback=priority;priority=this.PRE_RENDER}this._hooks[priority]=this._hooks[priority]||[];console.assert(this._hooks[priority].indexOf(callback)===-1);this._hooks[priority].push(callback);return callback};tQuery.Loop.prototype.unhook=function(priority,callback){if(typeof priority==="function"){callback=priority;priority=this.PRE_RENDER}var index=this._hooks[priority].indexOf(callback);console.assert(index!==-1);this._hooks[priority].splice(index,1);this._hooks[priority].length===0&&delete this._hooks[priority];return this};tQuery.Loop.prototype.hookPreRender=function(callback){return this.hook(this.PRE_RENDER,callback)};tQuery.Loop.prototype.hookOnRender=function(callback){return this.hook(this.ON_RENDER,callback)};tQuery.Loop.prototype.hookPostRender=function(callback){return this.hook(this.POST_RENDER,callback)};tQuery.Loop.prototype.unhookPreRender=function(callback){return this.unhook(this.PRE_RENDER,callback)};tQuery.Loop.prototype.unhookOnRender=function(callback){return this.unhook(this.ON_RENDER,callback)};tQuery.Loop.prototype.unhookPostRender=function(callback){return this.unhook(this.POST_RENDER,callback)};tQuery.registerStatic("createWorld",function(opts){return new tQuery.World(opts)});tQuery.registerStatic("createObject3D",function(){var object3d=new THREE.Object3D;return tQuery(object3d)});tQuery.registerStatic("createVector3",function(x,y,z){return tQuery.convert.toVector3.apply(tQuery.convert,arguments)});tQuery.registerStatic("createVector2",function(x,y){return new THREE.Vector2(x,y)});tQuery.registerStatic("createHemisphereLight",function(){var tLight=new THREE.HemisphereLight;return new tQuery.HemisphereLight([tLight])});tQuery.registerStatic("createDirectionalLight",function(){var tLight=new THREE.DirectionalLight;return new tQuery.DirectionalLight([tLight])});tQuery.registerStatic("createSpotLight",function(){var tLight=new THREE.SpotLight;return new tQuery.SpotLight([tLight])});tQuery.registerStatic("createPointLight",function(){var tLight=new THREE.PointLight;return new tQuery.PointLight([tLight])});tQuery.registerStatic("createAmbientLight",function(){var tLight=new THREE.AmbientLight;return new tQuery.AmbientLight([tLight])});tQuery.registerStatic("defaultObject3DMaterial",new THREE.MeshNormalMaterial);tQuery.Geometry.prototype.toMesh=function(material){var meshes=[];
this.each(function(tGeometry){material=material||tQuery.defaultObject3DMaterial;var mesh=new THREE.Mesh(tGeometry,material);meshes.push(mesh)});return new tQuery.Mesh(meshes)};tQuery.registerStatic("createCube",function(){var ctor=THREE.CubeGeometry;var dflGeometry=[1,1,1];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createTorus",function(){var ctor=THREE.TorusGeometry;var dflGeometry=[.5-.15,.15];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createTorusKnot",function(){var ctor=THREE.TorusKnotGeometry;var dflGeometry=[.27,.1,128,32];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createCircle",function(){var ctor=THREE.CircleGeometry;var dflGeometry=[.5,32];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createSphere",function(){var ctor=THREE.SphereGeometry;var dflGeometry=[.5,32,16];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createPlane",function(){var ctor=THREE.PlaneGeometry;var dflGeometry=[1,1,16,16];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("createCylinder",function(){var ctor=THREE.CylinderGeometry;var dflGeometry=[.5,.5,1,16,4];return this._createMesh(ctor,dflGeometry,arguments)});tQuery.registerStatic("_createMesh",function(ctor,dflGeometry,args){args=Array.prototype.slice.call(args);var material=tQuery.defaultObject3DMaterial;if(args.length&&args[args.length-1]instanceof THREE.Material){material=args.pop()}else if(args.length&&args[args.length-1]instanceof tQuery.Material){material=args.pop().get(0)}var createFn=function(ctor,a0,a1,a2,a3,a4,a5,a6,a7){console.assert(arguments.length<=9);return new ctor(a0,a1,a2,a3,a4,a5,a6,a7)};if(args.length===0)args=dflGeometry.slice();args.unshift(ctor);var geometry=createFn.apply(this,args);geometry.dynamic=true;var mesh=new THREE.Mesh(geometry,material);return tQuery(mesh)});tQuery.registerStatic("createAxis",function(){var axis=new THREE.AxisHelper;return tQuery(axis)});tQuery.AmbientLight=function(elements){tQuery.AmbientLight.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.AmbientLight)})};tQuery.inherit(tQuery.AmbientLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.AmbientLight);tQuery.DirectionalLight=function(elements){tQuery.DirectionalLight.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.DirectionalLight)})};tQuery.inherit(tQuery.DirectionalLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.DirectionalLight);tQuery.mixinAttributes(tQuery.DirectionalLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber,shadowDarkness:tQuery.convert.toNumberZeroToOne,shadowBias:tQuery.convert.toNumber,shadowMapWidth:tQuery.convert.toInteger,shadowMapHeight:tQuery.convert.toInteger,shadowCameraRight:tQuery.convert.toNumber,shadowCameraLeft:tQuery.convert.toNumber,shadowCameraTop:tQuery.convert.toNumber,shadowCameraBottom:tQuery.convert.toNumber,shadowCameraVisible:tQuery.convert.toBoolean,shadowCameraNear:tQuery.convert.toNumber,shadowCameraFar:tQuery.convert.toNumber});tQuery.HemisphereLight=function(elements){tQuery.HemisphereLight.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.HemisphereLight)})};tQuery.inherit(tQuery.HemisphereLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.HemisphereLight);tQuery.mixinAttributes(tQuery.HemisphereLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber,groundColor:tQuery.convert.toThreeColor});tQuery.PointLight=function(elements){tQuery.PointLight.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.PointLight)})};tQuery.inherit(tQuery.PointLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.PointLight);tQuery.mixinAttributes(tQuery.PointLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber});tQuery.SpotLight=function(elements){tQuery.SpotLight.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.SpotLight)})};tQuery.inherit(tQuery.SpotLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.SpotLight);tQuery.mixinAttributes(tQuery.SpotLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber,angle:tQuery.convert.toNumber,exponent:tQuery.convert.toNumber,onlyShadow:tQuery.convert.toBoolean,shadowDarkness:tQuery.convert.toNumberZeroToOne,shadowBias:tQuery.convert.toNumber,shadowMapWidth:tQuery.convert.toInteger,shadowMapHeight:tQuery.convert.toInteger,shadowCameraRight:tQuery.convert.toNumber,shadowCameraLeft:tQuery.convert.toNumber,shadowCameraTop:tQuery.convert.toNumber,shadowCameraBottom:tQuery.convert.toNumber,shadowCameraVisible:tQuery.convert.toBoolean,shadowCameraNear:tQuery.convert.toNumber,shadowCameraFar:tQuery.convert.toNumber});tQuery.Mesh.registerInstance("setBasicMaterial",function(opts){var material=tQuery.createMeshBasicMaterial(opts);this.material(material.get(0));return material.back(this)});tQuery.registerStatic("createMeshBasicMaterial",function(opts){var tMaterial=new THREE.MeshBasicMaterial(opts);var material=new tQuery.MeshBasicMaterial(tMaterial);return material});tQuery.MeshBasicMaterial=function(elements){tQuery.MeshBasicMaterial.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.MeshBasicMaterial)})};tQuery.inherit(tQuery.MeshBasicMaterial,tQuery.Material);tQuery.mixinAttributes(tQuery.MeshBasicMaterial,{color:tQuery.convert.toThreeColor,ambient:tQuery.convert.toThreeColor,map:tQuery.convert.toTexture,envMap:tQuery.convert.toTextureCube,refractionRatio:tQuery.convert.toNumber,blending:tQuery.convert.toNumber,side:tQuery.convert.identity,wireframe:tQuery.convert.toBoolean,wireframeLinewidth:tQuery.convert.toInteger,wireframeLinecap:tQuery.convert.toString});tQuery.Mesh.registerInstance("setLambertMaterial",function(opts){var material=tQuery.createMeshLambertMaterial(opts);this.material(material.get(0));return material.back(this)});tQuery.registerStatic("createMeshLambertMaterial",function(opts){var tMaterial=new THREE.MeshLambertMaterial(opts);var material=new tQuery.MeshLambertMaterial(tMaterial);return material});tQuery.MeshLambertMaterial=function(elements){tQuery.MeshLambertMaterial.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.MeshLambertMaterial)})};tQuery.inherit(tQuery.MeshLambertMaterial,tQuery.Material);tQuery.mixinAttributes(tQuery.MeshLambertMaterial,{color:tQuery.convert.toThreeColor,ambient:tQuery.convert.toThreeColor,map:tQuery.convert.toTexture,bumpMap:tQuery.convert.toTexture,bumpScale:tQuery.convert.toNumber,side:tQuery.convert.identity});tQuery.Mesh.registerInstance("setNormalMaterial",function(opts){var material=tQuery.createMeshNormalMaterial(opts);this.material(material.get(0));return material.back(this)});tQuery.registerStatic("createMeshNormalMaterial",function(opts){var tMaterial=new THREE.MeshNormalMaterial(opts);var material=new tQuery.MeshNormalMaterial(tMaterial);return material});tQuery.MeshNormalMaterial=function(elements){tQuery.MeshNormalMaterial.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.MeshNormalMaterial)})};tQuery.inherit(tQuery.MeshNormalMaterial,tQuery.Material);tQuery.Mesh.registerInstance("setPhongMaterial",function(opts){var material=tQuery.createMeshPhongMaterial(opts);this.material(material.get(0));return material.back(this)});tQuery.registerStatic("createMeshPhongMaterial",function(opts){var tMaterial=new THREE.MeshPhongMaterial(opts);var material=new tQuery.MeshPhongMaterial(tMaterial);return material});tQuery.MeshPhongMaterial=function(elements){tQuery.MeshPhongMaterial.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.MeshPhongMaterial)})};tQuery.inherit(tQuery.MeshPhongMaterial,tQuery.Material);tQuery.mixinAttributes(tQuery.MeshPhongMaterial,{map:tQuery.convert.toTexture,color:tQuery.convert.toThreeColor,ambient:tQuery.convert.toThreeColor,emissive:tQuery.convert.toThreeColor,specular:tQuery.convert.toThreeColor,shininess:tQuery.convert.toNumber,envMap:tQuery.convert.toTexture,refractionRatio:tQuery.convert.toNumber,reflectivity:tQuery.convert.toNumber,bumpMap:tQuery.convert.toTexture,bumpScale:tQuery.convert.toNumber,metal:tQuery.convert.toBoolean,perPixel:tQuery.convert.toBoolean});tQuery.Sprite.registerInstance("setSpriteMaterial",function(opts){var material=tQuery.createSpriteMaterial(opts).back(this);this.material(material.get(0));return material});tQuery.registerStatic("createSpriteMaterial",function(opts){opts=tQuery.extend(opts,{useScreenCoordinates:false});var tMaterial=new THREE.SpriteMaterial(opts);var material=new tQuery.SpriteMaterial(tMaterial);return material});tQuery.SpriteMaterial=function(elements){tQuery.SpriteMaterial.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.SpriteMaterial)})};tQuery.inherit(tQuery.SpriteMaterial,tQuery.Material);tQuery.mixinAttributes(tQuery.SpriteMaterial,{color:tQuery.convert.toThreeColor,map:tQuery.convert.toTexture,useScreenCoordinates:tQuery.convert.toBoolean,depthTest:tQuery.convert.toBoolean,sizeAttenuation:tQuery.convert.toBoolean,scaleByViewport:tQuery.convert.toBoolean,fog:tQuery.convert.toBoolean,opacity:tQuery.convert.toNumber,blending:tQuery.convert.toNumber});(function(){tQuery.Geometry.registerInstance("computeAll",function(){this.each(function(tGeometry){tGeometry.computeBoundingSphere();tGeometry.computeBoundingBox();tGeometry.computeCentroids();tGeometry.computeFaceNormals();tGeometry.computeVertexNormals()});return this});tQuery.Geometry.registerInstance("scaleBy",function(vector3){if(typeof vector3==="number"&&arguments.length===1){vector3=new THREE.Vector3(vector3,vector3,vector3)}else if(typeof vector3==="number"&&arguments.length===3){vector3=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(vector3 instanceof THREE.Vector3,"Geometry.vector3 parameter error");this.each(function(geometry){for(var i=0;i<geometry.vertices.length;i++){var vertex=geometry.vertices[i];vertex.multiply(vector3)}geometry.verticesNeedUpdate=true;geometry.computeBoundingBox()});return this});tQuery.Geometry.registerInstance("size",function(){console.assert(this.length<=1);if(this.length===0)return undefined;var geometry=this.get(0);var size=new THREE.Vector3;size.x=geometry.boundingBox.max.x-geometry.boundingBox.min.x;size.y=geometry.boundingBox.max.y-geometry.boundingBox.min.y;size.z=geometry.boundingBox.max.z-geometry.boundingBox.min.z;return size});tQuery.Geometry.registerInstance("normalize",function(){this.each(function(geometry){var node=tQuery(geometry);var size=node.size();if(size.x>=size.y&&size.x>=size.z){node.zoom(1/size.x)}else if(size.y>=size.x&&size.y>=size.z){node.zoom(1/size.y)}else{node.zoom(1/size.z)}});return this});tQuery.Geometry.registerInstance("middlePoint",function(){console.assert(this.length<=1);if(this.length===0)return undefined;var geometry=this.get(0);var middle=new THREE.Vector3;middle.x=(geometry.boundingBox.max.x+geometry.boundingBox.min.x)/2;middle.y=(geometry.boundingBox.max.y+geometry.boundingBox.min.y)/2;middle.z=(geometry.boundingBox.max.z+geometry.boundingBox.min.z)/2;return middle});tQuery.Geometry.registerInstance("translate",function(delta){if(typeof delta==="number"&&arguments.length===3){delta=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(delta instanceof THREE.Vector3,"Geometry.translate parameter error");this.each(function(geometry){for(var i=0;i<geometry.vertices.length;i++){var vertex=geometry.vertices[i];vertex.add(delta)}geometry.verticesNeedUpdate=true;geometry.computeBoundingBox()});return this});tQuery.Geometry.registerInstance("rotate",function(angles,order){if(typeof angles==="number"&&arguments.length===3){angles=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(angles instanceof THREE.Vector3,"Geometry.rotate parameter error");order=order||"XYZ";var matrix=new THREE.Matrix4;matrix.makeRotationFromEuler(angles,order);this.each(function(geometry){geometry.applyMatrix(matrix);geometry.verticesNeedUpdate=true;geometry.computeBoundingBox()});return this});tQuery.Geometry.registerInstance("center",function(noX,noY,noZ){this.each(function(tGeometry){var geometry=tQuery(tGeometry);var delta=geometry.middlePoint().negate();if(noX)delta.x=0;if(noY)delta.y=0;if(noZ)delta.z=0;return geometry.translate(delta)});return this});tQuery.Geometry.registerInstance("translateX",function(delta){return this.translate(delta,0,0)});tQuery.Geometry.registerInstance("translateY",function(delta){return this.translate(0,delta,0)});tQuery.Geometry.registerInstance("translateZ",function(delta){return this.translate(0,0,delta)});tQuery.Geometry.registerInstance("rotateX",function(angle){return this.rotate(angle,0,0)});tQuery.Geometry.registerInstance("rotateY",function(angle){return this.rotate(0,angle,0)});tQuery.Geometry.registerInstance("rotateZ",function(angle){return this.rotate(0,0,angle)});tQuery.Geometry.registerInstance("scaleXBy",function(ratio){return this.scaleBy(ratio,1,1)});tQuery.Geometry.registerInstance("scaleYBy",function(ratio){return this.scaleBy(1,ratio,1)});tQuery.Geometry.registerInstance("scaleZBy",function(ratio){return this.scaleBy(1,1,ratio)});tQuery.Geometry.registerInstance("zoom",function(value){return this.scaleBy(value)});tQuery.Geometry.registerInstance("zoomX",function(ratio){return this.zoom(ratio,1,1)});tQuery.Geometry.registerInstance("zoomY",function(ratio){return this.zoom(1,ratio,1)});tQuery.Geometry.registerInstance("zoomZ",function(ratio){return this.zoom(1,1,ratio)})})();tQuery.Object3D.registerInstance("position",function(vector3){if(vector3===undefined)return this.get(0).position;vector3=tQuery.convert.toVector3.apply(null,arguments);this.each(function(tObject3d){tObject3d.position.copy(vector3)});return this});tQuery.Object3D.registerInstance("positionX",function(scalar){if(scalar===undefined)return this.get(0).position.x;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.position.x=scalar});return this});tQuery.Object3D.registerInstance("positionY",function(scalar){if(scalar===undefined)return this.get(0).position.y;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.position.y=scalar});return this});tQuery.Object3D.registerInstance("positionZ",function(scalar){if(scalar===undefined)return this.get(0).position.z;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.position.z=scalar});return this});tQuery.Object3D.registerInstance("translate",function(delta){if(typeof delta==="number"&&arguments.length===3){delta=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(delta instanceof THREE.Vector3,"Object3D.translate parameter error");this.each(function(object3d){object3d.position.add(delta)});return this});tQuery.Object3D.registerInstance("translateX",function(delta){return this.translate(delta,0,0)});tQuery.Object3D.registerInstance("translateY",function(delta){return this.translate(0,delta,0)});tQuery.Object3D.registerInstance("translateZ",function(delta){return this.translate(0,0,delta)});tQuery.Object3D.registerInstance("rotation",function(vector3){if(vector3===undefined)return this.get(0).rotation;if(typeof vector3==="number"&&arguments.length===3){vector3=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(vector3 instanceof THREE.Vector3,"Object3D.rotation parameter error");this.each(function(object3d){object3d.rotation.x=vector3.x;object3d.rotation.y=vector3.y;object3d.rotation.z=vector3.z});return this});tQuery.Object3D.registerInstance("rotationX",function(scalar){if(scalar===undefined)return this.get(0).rotation.x;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.rotation.x=scalar});return this});tQuery.Object3D.registerInstance("rotationY",function(scalar){if(scalar===undefined)return this.get(0).rotation.y;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.rotation.y=scalar});return this});tQuery.Object3D.registerInstance("rotationZ",function(scalar){if(scalar===undefined)return this.get(0).rotation.z;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.rotation.z=scalar});return this});tQuery.Object3D.registerInstance("rotate",function(angles){if(typeof angles==="number"&&arguments.length===3){angles=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(angles instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(object3d){object3d.rotation.x+=angles.x;object3d.rotation.y+=angles.y;object3d.rotation.z+=angles.z});return this});tQuery.Object3D.registerInstance("rotateX",function(angle){return this.rotate(angle,0,0)});tQuery.Object3D.registerInstance("rotateY",function(angle){return this.rotate(0,angle,0)});tQuery.Object3D.registerInstance("rotateZ",function(angle){return this.rotate(0,0,angle)});tQuery.Object3D.registerInstance("scale",function(vector3){if(vector3===undefined)return this.get(0).scale;if(typeof vector3==="number"&&arguments.length===1){vector3=new THREE.Vector3(vector3,vector3,vector3)}else if(typeof vector3==="number"&&arguments.length===3){vector3=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(vector3 instanceof THREE.Vector3,"Object3D.scale parameter error");this.each(function(tObject3d){tObject3d.scale.copy(vector3)});return this});tQuery.Object3D.registerInstance("scaleX",function(scalar){if(scalar===undefined)return this.get(0).scale.x;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.scale.x=scalar});return this});tQuery.Object3D.registerInstance("scaleY",function(scalar){if(scalar===undefined)return this.get(0).scale.y;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.scale.y=scalar});return this});tQuery.Object3D.registerInstance("scaleZ",function(scalar){if(scalar===undefined)return this.get(0).scale.z;console.assert(typeof scalar==="number"&&arguments.length===1);this.each(function(object3d){object3d.scale.z=scalar});return this});tQuery.Object3D.registerInstance("scaleBy",function(ratio){if(typeof ratio==="number"&&arguments.length===1){ratio=new THREE.Vector3(ratio,ratio,ratio)}else if(typeof ratio==="number"&&arguments.length===3){ratio=new THREE.Vector3(arguments[0],arguments[1],arguments[2])}console.assert(ratio instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(object3d){object3d.scale.multiply(ratio)});return this});tQuery.Object3D.registerInstance("scaleXBy",function(ratio){return this.scaleBy(ratio,1,1)});tQuery.Object3D.registerInstance("scaleYBy",function(ratio){return this.scaleBy(1,ratio,1)});tQuery.Object3D.registerInstance("scaleZBy",function(ratio){return this.scaleBy(1,1,ratio)});tQuery.Texture=function(elements){tQuery.Texture.parent.constructor.call(this,elements);this._lists.forEach(function(item){console.assert(item instanceof THREE.Texture)})};tQuery.inherit(tQuery.Texture,tQuery.Node);tQuery.pluginsStaticOn(tQuery.Texture);tQuery.pluginsInstanceOn(tQuery.Texture);tQuery.mixinAttributes(tQuery.Texture,{offset:tQuery.convert.toVector2,repeat:tQuery.convert.toVector2});